<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScamSafe - Insights</title>
    <link rel="icon" type="image/x-icon" href="./assets/favicon.ico">

    <!-- External Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Site Styles -->
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/responsive.css">

    <style>
      body.insights-app-bg {
        background:
          radial-gradient(85% 70% at 18% 12%, rgba(249,115,22,.32), transparent 75%),
          radial-gradient(65% 55% at 88% 82%, rgba(234,179,8,.28), transparent 72%),
          linear-gradient(180deg, #fff2e1 0%, #ffe8d2 42%, #fde7d5 100%);
        min-height: 100vh;
        position: relative;
        color: #7c2d12;
      }
      .ins-react-root { position: relative; z-index: 1; }
      .ins-app-shell {
        position: relative;
        min-height: 100%;
        padding-bottom: 3rem;
      }
      .ins-backdrop {
        position: absolute;
        inset: 0;
        pointer-events: none;
        z-index: 0;
        overflow: hidden;
      }
      .ins-backdrop::before,
      .ins-backdrop::after {
        content: '';
        position: absolute;
        border-radius: 999px;
        filter: blur(120px);
        opacity: .28;
      }
      .ins-backdrop::before {
        width: 520px;
        height: 520px;
        background: rgba(249,115,22,.38);
        top: -160px;
        left: -150px;
      }
      .ins-backdrop::after {
        width: 360px;
        height: 360px;
        background: rgba(251,191,36,.32);
        bottom: -120px;
        right: -90px;
      }
      .ins-backdrop-canvas {
        position: absolute;
        inset: 0;
        opacity: .08;
        background-image:
          linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,0) 60%),
          repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0px, rgba(255,255,255,.04) 1px, transparent 1px, transparent 80px),
          repeating-linear-gradient(90deg, rgba(255,255,255,.05) 0px, rgba(255,255,255,0) 110px),
          radial-gradient( circle at 20% 30%, rgba(249,115,22,.18) 0%, transparent 55%),
          radial-gradient( circle at 80% 60%, rgba(234,179,8,.2) 0%, transparent 60%);
      }
      .ins-geo-shape {
        position: absolute;
        border-radius: 18px;
        border: 1px solid rgba(255,255,255,.08);
        backdrop-filter: blur(2px);
        opacity: .3;
      }
      .ins-geo-shape.one { width: 140px; height: 140px; top: 22%; right: 12%; transform: rotate(14deg); }
      .ins-geo-shape.two { width: 90px; height: 90px; top: 64%; left: 14%; transform: rotate(-18deg); }
      .ins-geo-circle {
        position: absolute;
        width: 220px;
        height: 220px;
        border-radius: 50%;
        border: 1px solid rgba(255,255,255,.12);
        top: 30%;
        right: 28%;
        box-shadow: 0 0 40px rgba(249,115,22,.18);
        opacity: .22;
      }
      .ins-content { position: relative; z-index: 1; }
      .ins-main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1.5rem 4rem;
      }
      .ins-header-card {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.25rem;
        background: rgba(255,255,255,.88);
        border: 1px solid rgba(253,186,116,.6);
        border-radius: 20px;
        padding: 1.25rem 1.5rem;
        box-shadow: 0 20px 60px rgba(249,115,22,.18);
        backdrop-filter: blur(8px);
      }
      .ins-header-left { display: flex; align-items: center; gap: 1rem; }
      .ins-header-icon {
        width: 56px;
        height: 56px;
        border-radius: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #fb923c, #f97316);
        color: #fff;
        font-size: 1.6rem;
      }
      .ins-header-title { font-size: 1.4rem; font-weight: 700; color: #7c2d12; }
      .ins-header-sub { margin-top: .25rem; font-size: .95rem; color: #9a3412; }
      .ins-header-actions { display: flex; gap: .75rem; }
      .ins-header-btn {
        display: inline-flex;
        align-items: center;
        gap: .35rem;
        padding: .55rem 1.1rem;
        border-radius: 999px;
        border: 1px solid rgba(248,113,113,.35);
        background: rgba(255,255,255,.95);
        color: #b91c1c;
        font-weight: 600;
        cursor: pointer;
        transition: transform .18s ease, box-shadow .18s ease;
      }
      .ins-header-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 28px rgba(248,113,113,.25);
      }
      .ins-metric-grid {
        margin-top: 1.6rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.1rem;
      }
      .ins-metric-card {
        background: rgba(255,255,255,.94);
        border: 1px solid rgba(253,186,116,.55);
        border-radius: 18px;
        padding: 1.2rem 1.1rem;
        display: flex;
        flex-direction: column;
        gap: .65rem;
        box-shadow: 0 18px 48px rgba(251,146,60,.2);
        transition: transform .24s ease, box-shadow .24s ease, border-color .24s ease, background .24s ease;
      }
      .ins-metric-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 26px 60px rgba(251,146,60,.33);
        border-color: rgba(248,113,113,.65);
        background: linear-gradient(135deg, rgba(255,237,213,.98), rgba(255,247,237,.96));
      }
      .ins-metric-top { display: flex; justify-content: space-between; align-items: center; }
      .ins-metric-title { font-size: .95rem; color: #78350f; font-weight: 600; }
      .ins-metric-icon {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: rgba(251,146,60,.18);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ea580c;
        font-size: 1.15rem;
      }
      .ins-metric-value { font-size: 1.7rem; font-weight: 700; color: #7c2d12; }
      .ins-metric-desc { font-size: .85rem; color: #a16207; }
      .ins-metric-trend {
        display: inline-flex;
        align-items: center;
        gap: .35rem;
        padding: .35rem .7rem;
        border-radius: 999px;
        font-size: .8rem;
        font-weight: 600;
      }
      .ins-metric-trend.up { background: rgba(34,197,94,.15); color: #166534; }
      .ins-metric-trend.down { background: rgba(248,113,113,.18); color: #b91c1c; }
      .ins-metric-trend.neutral { background: rgba(107,114,128,.15); color: #374151; }
      .ins-section-grid {
        margin-top: 1.8rem;
        display: grid;
        gap: 1.25rem;
      }
      .ins-section-grid.charts { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
      .ins-section-grid.triple { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
      .ins-card-shell {
        background: rgba(255,255,255,.95);
        border: 1px solid rgba(254,227,159,.6);
        border-radius: 20px;
        padding: 1.25rem 1.4rem 1.4rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 58px rgba(250,204,21,.2);
        transition: transform .24s ease, box-shadow .24s ease, border-color .24s ease, background .24s ease;
      }
      .ins-card-shell::before {
        content: '';
        position: absolute;
        inset: -65% 32% auto -40%;
        height: 220px;
        background: radial-gradient(160px at 25% 30%, rgba(249,115,22,.18), transparent 65%);
        opacity: .6;
        pointer-events: none;
        transition: transform .4s ease, opacity .4s ease;
      }
      .ins-card-shell:hover {
        transform: translateY(-6px);
        box-shadow: 0 26px 70px rgba(250,204,21,.28);
        border-color: rgba(248,113,113,.55);
        background: linear-gradient(135deg, rgba(255,237,213,.98), rgba(255,247,237,.98));
      }
      .ins-card-shell:hover::before {
        transform: translate(14px, -10px) scale(1.05);
        opacity: .78;
      }
      .ins-card-shell h2 {
        font-size: 1.15rem;
        font-weight: 700;
        color: #7c2d12;
        margin: 0 0 .45rem;
      }
      .ins-card-shell .ins-sub {
        color: #a16207;
        font-size: .9rem;
        margin-bottom: 1rem;
      }
      .ins-alerts-header { display: flex; align-items: center; gap: .85rem; margin-bottom: 1.1rem; }
      .ins-alerts-header-icon {
        width: 42px;
        height: 42px;
        border-radius: 14px;
        background: linear-gradient(135deg, #f97316, #fb923c);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 1.3rem;
      }
      .ins-alerts-header-title { font-size: 1.15rem; font-weight: 700; color: #7c2d12; }
      .ins-alerts-header-sub { font-size: .9rem; color: #a16207; margin-top: .1rem; }
      .ins-alerts-list { display: flex; flex-direction: column; gap: .85rem; }
      .ins-alert-item {
        display: flex;
        gap: .9rem;
        align-items: flex-start;
        padding: 1rem 1.1rem;
        border-radius: 18px;
        background: rgba(249,250,251,.92);
        border: 1px solid rgba(226,232,240,.6);
        box-shadow: 0 14px 32px rgba(15,23,42,.06);
        transition: transform .22s ease, box-shadow .22s ease, background .22s ease, border-color .22s ease;
      }
      .ins-alert-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 22px 48px rgba(15,23,42,.16);
        background: linear-gradient(135deg, rgba(255,235,213,.94), rgba(255,247,237,.96));
        border-color: rgba(249,115,22,.35);
      }
      .ins-alert-item-icon {
        width: 46px;
        height: 46px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        color: #fff;
        flex-shrink: 0;
        transition: transform .25s ease;
      }
      .ins-alert-item:hover .ins-alert-item-icon { transform: scale(1.08) rotate(-4deg); }
      .ins-alert-item-body { display: flex; flex-direction: column; gap: .4rem; }
      .ins-alert-item-head { display: flex; align-items: center; gap: .6rem; }
      .ins-alert-item-type { font-weight: 700; color: #0f172a; font-size: .98rem; }
      .ins-alert-badge {
        font-size: .72rem;
        font-weight: 700;
        text-transform: uppercase;
        padding: .18rem .55rem;
        border-radius: 999px;
        letter-spacing: .05em;
      }
      .ins-alert-badge.severity-high { background: #ef4444; color: #fff; }
      .ins-alert-badge.severity-medium { background: #f97316; color: #fff; }
      .ins-alert-badge.severity-low { background: #facc15; color: #7c2d12; }
      .ins-alert-item-text { font-size: .9rem; color: #475569; }
      .ins-alert-item-time { font-size: .82rem; color: #94a3b8; }
      .ins-highlights-grid { display: grid; gap: .85rem; }
      .ins-highlight {
        background: rgba(255,255,255,.9);
        border: 1px solid rgba(217,119,6,.25);
        border-radius: 14px;
        padding: .85rem 1rem;
        transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease, background .22s ease;
      }
      .ins-highlight:hover {
        transform: translateY(-3px);
        box-shadow: 0 16px 34px rgba(234,88,12,.18);
        border-color: rgba(249,115,22,.35);
        background: linear-gradient(135deg, rgba(255,235,205,.94), rgba(255,247,237,.97));
      }
      .ins-highlight .label { font-size: .78rem; color: #b45309; text-transform: uppercase; letter-spacing: .05em; }
      .ins-highlight .value { font-size: 1.2rem; font-weight: 700; color: #7c2d12; margin-top: .2rem; }
      .ins-highlight .detail { font-size: .88rem; color: #a16207; margin-top: .25rem; }
      .ins-tips { display: flex; flex-direction: column; gap: .85rem; }
      .ins-tip {
        background: rgba(255,255,255,.92);
        border: 1px solid rgba(251,191,36,.35);
        border-radius: 14px;
        padding: .9rem 1rem;
        transition: transform .22s ease, box-shadow .22s ease, border-color .22s ease, background .22s ease;
      }
      .ins-tip:hover {
        transform: translateY(-3px);
        box-shadow: 0 16px 36px rgba(202,138,4,.2);
        border-color: rgba(251,146,60,.45);
        background: linear-gradient(135deg, rgba(255,238,215,.95), rgba(255,247,237,.98));
      }
      .ins-tip-title { font-weight: 600; color: #854d0e; margin-bottom: .25rem; }
      .ins-tip-text { font-size: .9rem; color: #a16207; }
      .ins-data-source {
        margin-top: 2rem;
        text-align: center;
        font-size: .85rem;
        color: #a16207;
      }
      .ins-data-source a {
        color: #c2410c;
        font-weight: 600;
        text-decoration: none;
      }
      .ins-data-source a:hover {
        text-decoration: underline;
      }
      .ins-loading { display: flex; align-items: center; justify-content: center; min-height: 320px; font-weight: 600; color: #9a3412; }
      .ins-error-box { background: rgba(248,113,113,.18); border: 1px solid rgba(248,113,113,.35); border-radius: 16px; padding: 1rem 1.2rem; color: #b91c1c; font-weight: 600; }
      @media (max-width: 768px) {
        .ins-header-card { flex-direction: column; align-items: flex-start; }
        .ins-header-actions { width: 100%; }
        .ins-header-btn { width: 100%; justify-content: center; }
        .ins-alert { flex-direction: column; }
      }
      .navbar {
          position: relative;
          z-index: 1000; /* 让导航浮在 React 背景之上 */
          background: #fff;
      }

      .nav-container {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          align-items: center;
          justify-content: space-between;
      }

      .nav-links li {
          display: inline-block;
          margin: 0 10px;
      }

      .dropdown-menu {
          background: #fff;
          box-shadow: 0 8px 24px rgba(0,0,0,0.08);
          border-radius: 8px;
          z-index: 9999;
      }
    </style>
</head>
<body class="insights-app-bg">
<!-- Navigation -->
<nav class="navbar" id="navbar">
    <div class="nav-container">
        <a href="home.html#home" class="logo">
            <img src="/assets/images/logo.png" alt="ScamSafe Logo" class="logo-img">
        </a>
        <div class="nav-controls">
            <ul class="nav-links">
                <li><a href="home.html#home" class="nav-link">Home</a></li>
                <li><a href="education.html" class="nav-link">Scam Quiz</a></li>
                <li><a href="game-inbox.html" class="nav-link">Game</a></li>
                <li><a href="ScamShield_AI.html" class="nav-link">ScamSense</a></li>
                <li><a href="insights.html" class="nav-link">Insights</a></li>
                <li><a href="scam-stories.html" class="nav-link">Community</a></li>                
                <li><a href="ai-assistant.html" class="nav-link active">AI Assistant</a></li>
                <li class="dropdown">
                    <a href="javascript:void(0)" class="nav-link dropdown-toggle">More ▾</a>
                    <ul class="dropdown-menu"></ul>
                </li>
            </ul>
            <div class="font-controls">
                <button class="font-btn" data-size="small" type="button" title="Smaller"><i class="fa-solid fa-minus"></i></button>
                <button class="font-btn active" data-size="normal" type="button" title="Default"><i class="fa-solid fa-rotate-left"></i></button>
                <button class="font-btn" data-size="large" type="button" title="Larger"><i class="fa-solid fa-plus"></i></button>
            </div>
        </div>
    </div>
    </nav>

<!-- App Root -->
<main class="ins-react-root">
  <div id="root"></div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="privacy.html">Privacy Policy</a>
            <a href="terms.html">Terms of Service</a>
        </div>
        <div class="footer-disclaimer">
            <p>This website is maintained by ScamSafe as a public welfare initiative. Information provided is for educational purposes only.</p>
        </div>
    </div>
</footer>

<script>
  // Keep nav active highlighting
  document.addEventListener('DOMContentLoaded', () => {
    const links = document.querySelectorAll('.nav-link');
    links.forEach(a => a.classList.remove('active'));
    const current = [...links].find(a => a.getAttribute('href') === 'insights.html') ||
                    [...links].find(a => a.getAttribute('href')?.includes('#home'));
    if (current) current.classList.add('active');
  });
</script>

<!-- React + Recharts via ESM (no local build needed) -->
<script type="module">
  import React, { useEffect, useMemo, useState } from 'https://esm.sh/react@18.3.1';
  import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';
  import {
    LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
    PieChart, Pie, Cell, Legend
  } from 'https://esm.sh/recharts@2.15.2?deps=react@18.3.1,react-dom@18.3.1';

  const h = React.createElement;
  const numberFmt = new Intl.NumberFormat('en-US');
  const currencyFmt = new Intl.NumberFormat('en-AU', { style: 'currency', currency: 'AUD', maximumFractionDigits: 0 });

  const monthName = (iso, options) => {
    if (!iso) return '—';
    const [y, m] = iso.split('-').map((v) => parseInt(v, 10));
    const date = new Date(y || 0, (m || 1) - 1, 1);
    return date.toLocaleDateString('en-AU', options);
  };

  const fetchJson = async (path) => {
    const res = await fetch(path, { cache: 'no-store' });
    if (!res.ok) throw new Error(`Failed to load ${path}`);
    return res.json();
  };

  const loadInsights = async () => {
    const base = './assets/data/insights';
    const [kpis, monthly, ageGroups, modes, level2, level3, states] = await Promise.all([
      fetchJson(`${base}/kpis.json`),
      fetchJson(`${base}/monthly.json`),
      fetchJson(`${base}/age_groups.json`),
      fetchJson(`${base}/modes.json`),
      fetchJson(`${base}/cat_level2.json`),
      fetchJson(`${base}/cat_level3.json`),
      fetchJson(`${base}/states.json`),
    ]);
    return { kpis, monthly, ageGroups, modes, level2, level3, states };
  };

  const trendDescriptor = (value, label) => {
    if (value == null || !isFinite(value)) return null;
    const type = value > 0 ? 'up' : value < 0 ? 'down' : 'neutral';
    return { type, label: `${Math.abs(value).toFixed(1)}% ${label}` };
  };

  const computeInsights = (data) => {
    const monthlySorted = data.monthly.slice().sort((a, b) => a.month.localeCompare(b.month));
    const last = monthlySorted[monthlySorted.length - 1] || { month: '', reports: 0, loss: 0 };
    const prev = monthlySorted[monthlySorted.length - 2] || last;
    const monthTrend = prev.reports ? ((last.reports - prev.reports) / prev.reports) * 100 : 0;
    const lastLabel = monthName(last.month, { month: 'long', year: 'numeric' });
    const prevLabel = monthName(prev.month, { month: 'long', year: 'numeric' });

    const last12 = monthlySorted.slice(-12);
    const prev12 = monthlySorted.slice(-24, -12);
    const ytdReports = last12.reduce((sum, m) => sum + (m.reports || 0), 0);
    const prevYtdReports = prev12.reduce((sum, m) => sum + (m.reports || 0), 0);
    const ytdTrend = prevYtdReports ? ((ytdReports - prevYtdReports) / prevYtdReports) * 100 : null;
    const ytdLoss = data.kpis?.loss || last12.reduce((sum, m) => sum + (m.loss || 0), 0);

    const topState = data.states.slice().sort((a, b) => b.reports - a.reports)[0] || {};
    const topMode = data.modes.slice().sort((a, b) => b.reports - a.reports)[0] || {};
    const topCategory = data.level2.slice().sort((a, b) => b.reports - a.reports)[0] || {};
    const topAge = data.ageGroups.slice().sort((a, b) => b.reports - a.reports)[0] || {};

    const monthlyChart = last12.map((item) => ({
      month: monthName(item.month, { month: 'short', year: '2-digit' }),
      reports: item.reports,
      lossMillions: Math.round((item.loss || 0) / 1_000_000),
    }));

    const categoriesChart = data.level2
      .slice()
      .sort((a, b) => b.reports - a.reports)
      .slice(0, 8)
      .map((item) => ({ type: item.category, count: item.reports }));

    const metrics = [
      {
        title: 'Reports (latest month)',
        value: numberFmt.format(last.reports || 0),
        description: lastLabel,
        icon: 'fa-triangle-exclamation',
        trend: trendDescriptor(monthTrend, `vs ${prevLabel}`),
      },
      {
        title: 'Reports (12 mo rolling)',
        value: numberFmt.format(ytdReports || 0),
        description: `${monthName(last12[0]?.month, { month: 'short', year: 'numeric' })} – ${lastLabel}`,
        icon: 'fa-chart-line',
        trend: trendDescriptor(ytdTrend, 'vs prior year'),
      },
      {
        title: 'Total losses',
        value: currencyFmt.format(ytdLoss || 0),
        description: 'Reported losses across rolling 12 months',
        icon: 'fa-sack-dollar',
        trend: null,
      },
      {
        title: 'Top state',
        value: topState.state || '—',
        description: `${numberFmt.format(topState.reports || 0)} reports`,
        icon: 'fa-map-pin',
        trend: null,
      },
    ];

    const recentAlerts = [
      {
        id: 'investment-scam',
        type: 'Investment Scam',
        severity: 'high',
        severityLabel: 'High',
        description: 'Fake cryptocurrency investment platform targeting seniors.',
        timeAgo: '2 hours ago',
        icon: 'fa-sack-dollar',
        iconBg: 'linear-gradient(135deg, #fb7185, #f43f5e)',
        iconColor: '#fff',
      },
      {
        id: 'phone-scam',
        type: 'Phone Scam',
        severity: 'high',
        severityLabel: 'High',
        description: 'IRS impersonation calls requesting immediate payment.',
        timeAgo: '4 hours ago',
        icon: 'fa-phone',
        iconBg: 'linear-gradient(135deg, #fb923c, #ef4444)',
        iconColor: '#fff',
      },
      {
        id: 'email-scam',
        type: 'Email Scam',
        severity: 'medium',
        severityLabel: 'Medium',
        description: 'Medicare enrolment phishing emails detected.',
        timeAgo: '6 hours ago',
        icon: 'fa-envelope',
        iconBg: 'linear-gradient(135deg, #facc15, #fb923c)',
        iconColor: '#7c2d12',
      },
      {
        id: 'romance-scam',
        type: 'Romance Scam',
        severity: 'medium',
        severityLabel: 'Medium',
        description: 'Dating profiles requesting emergency money transfers.',
        timeAgo: '8 hours ago',
        icon: 'fa-heart',
        iconBg: 'linear-gradient(135deg, #fda4af, #fb7185)',
        iconColor: '#fff',
      },
    ];

    const highlights = [
      { label: 'Top state', value: topState.state || '—', detail: `${numberFmt.format(topState.reports || 0)} reports` },
      { label: 'Leading age group', value: topAge.age || '—', detail: `${numberFmt.format(topAge.reports || 0)} reports` },
      { label: 'Top contact mode', value: topMode.mode || '—', detail: `${numberFmt.format(topMode.reports || 0)} reports` },
      { label: 'Top category (L2)', value: topCategory.category || '—', detail: `${numberFmt.format(topCategory.reports || 0)} reports` },
    ];

    return {
      metrics,
      monthlyChart,
      categoriesChart,
      recentAlerts,
      highlights,
      periodLabel: `${monthName(last12[0]?.month, { month: 'short', year: 'numeric' })} – ${lastLabel}`,
    };
  };

  const HeaderSection = ({ period }) => (
    h('div', { className: 'ins-header-card' },
      h('div', { className: 'ins-header-left' },
        h('div', { className: 'ins-header-icon' }, h('i', { className: 'fa-solid fa-shield-halved' })),
        h('div', null,
          h('div', { className: 'ins-header-title' }, 'ScamSafe Insights Dashboard'),
          h('div', { className: 'ins-header-sub' }, `Reporting window: ${period}`),
        ),
      ),
      h('div', { className: 'ins-header-actions' },
        h('button', { className: 'ins-header-btn', type: 'button' }, h('i', { className: 'fa-solid fa-bell' }), ' Alerts')
      )
    )
  );

  const MetricCard = ({ metric }) => (
    h('div', { className: 'ins-metric-card' },
      h('div', { className: 'ins-metric-top' },
        h('div', { className: 'ins-metric-title' }, metric.title),
        h('div', { className: 'ins-metric-icon' }, h('i', { className: `fa-solid ${metric.icon}` })),
      ),
      h('div', { className: 'ins-metric-value' }, metric.value),
      h('div', { className: 'ins-metric-desc' }, metric.description),
      metric.trend ? h('div', { className: `ins-metric-trend ${metric.trend.type}` },
        h('i', { className: metric.trend.type === 'up' ? 'fa-solid fa-arrow-trend-up' : metric.trend.type === 'down' ? 'fa-solid fa-arrow-trend-down' : 'fa-solid fa-minus' }),
        metric.trend.label,
      ) : null,
    )
  );

  const MetricGrid = ({ metrics }) => (
    h('div', { className: 'ins-metric-grid' }, metrics.map((metric, idx) => h(MetricCard, { metric, key: idx })))
  );

  const Card = ({ title, subtitle, children }) => (
    h('div', { className: 'ins-card-shell' },
      title ? h('h2', null, title) : null,
      subtitle ? h('p', { className: 'ins-sub' }, subtitle) : null,
      children,
    )
  );

  const MonthlyChart = ({ data }) => {
    if (!data || !data.length) return h('div', { className: 'ins-error-box' }, 'No monthly data available.');
    return h('div', { style: { height: '320px' } },
      h(ResponsiveContainer, { width: '100%', height: '100%' },
        h(LineChart, { data },
          h(CartesianGrid, { strokeDasharray: '3 3', stroke: '#fde68a' }),
          h(XAxis, { dataKey: 'month', stroke: '#92400e', fontSize: 12 }),
          h(YAxis, { yAxisId: 'left', stroke: '#92400e', fontSize: 12, tickFormatter: (v) => numberFmt.format(v) }),
          h(YAxis, { yAxisId: 'right', orientation: 'right', stroke: '#f59e0b', fontSize: 12, tickFormatter: (v) => `${v}M` }),
          h(Tooltip, {
            formatter: (value, name) => name === 'Loss (AUD millions)'
              ? [`${value}M`, 'Loss (AUD)']
              : [numberFmt.format(value), 'Reports'],
          }),
          h(Line, { yAxisId: 'left', type: 'monotone', dataKey: 'reports', stroke: '#dc2626', strokeWidth: 3, dot: { r: 3 }, name: 'Reports' }),
          h(Line, { yAxisId: 'right', type: 'monotone', dataKey: 'lossMillions', stroke: '#f59e0b', strokeWidth: 3, dot: { r: 3 }, name: 'Loss (AUD millions)' }),
        )
      )
    );
  };

  const CategoriesChart = ({ data }) => {
    if (!data || !data.length) return h('div', { className: 'ins-error-box' }, 'No category data available.');
    const palette = ['#fb923c', '#f97316', '#f59e0b', '#facc15', '#fde68a', '#fdba74', '#fda4af', '#fb7185'];
    return h('div', { style: { height: '320px' } },
      h(ResponsiveContainer, { width: '100%', height: '100%' },
        h(PieChart, { margin: { top: 0, right: 100, bottom: 0, left: 0 } },
          h(Pie, {
            data,
            dataKey: 'count',
            nameKey: 'type',
            innerRadius: '45%',
            outerRadius: '80%',
            paddingAngle: 2,
            stroke: '#fff',
            strokeWidth: 1,
          },
            data.map((entry, index) => h(Cell, {
              key: entry.type,
              fill: palette[index % palette.length],
            }))
          ),
          h(Tooltip, { formatter: (value, name) => [`${numberFmt.format(value)} reports`, name] }),
          h(Legend, { layout: 'vertical', align: 'right', verticalAlign: 'middle', iconType: 'circle' })
        )
      )
    );
  };

  const RecentAlerts = ({ alerts }) => (
    h('div', null,
      h('div', { className: 'ins-alerts-header' },
        h('div', { className: 'ins-alerts-header-icon' }, h('i', { className: 'fa-solid fa-triangle-exclamation' })),
        h('div', null,
          h('div', { className: 'ins-alerts-header-title' }, 'Recent Scam Alerts'),
          h('div', { className: 'ins-alerts-header-sub' }, 'Latest scam reports from our community'),
        ),
      ),
      h('div', { className: 'ins-alerts-list' },
        alerts && alerts.length ? alerts.map((alert) => (
          h('div', { key: alert.id, className: 'ins-alert-item' },
            h('div', { className: 'ins-alert-item-icon', style: { background: alert.iconBg, color: alert.iconColor } },
              h('i', { className: `fa-solid ${alert.icon}` })
            ),
            h('div', { className: 'ins-alert-item-body' },
              h('div', { className: 'ins-alert-item-head' },
                h('span', { className: 'ins-alert-item-type' }, alert.type),
                h('span', { className: `ins-alert-badge severity-${alert.severity}` }, alert.severityLabel)
              ),
              h('div', { className: 'ins-alert-item-text' }, alert.description),
              h('div', { className: 'ins-alert-item-time' }, alert.timeAgo)
            )
          )
        )) : h('div', { className: 'ins-alert-item', style: { background: 'rgba(249,250,251,.78)', justifyContent: 'center', alignItems: 'center' } },
          h('div', { className: 'ins-alert-item-body', style: { alignItems: 'center' } },
            h('div', { className: 'ins-alert-item-text' }, 'No alerts to display right now.')
          )
        )
      )
    )
  );

  const Highlights = ({ highlights }) => (
    h('div', { className: 'ins-highlights-grid' }, highlights.map((item, idx) => (
      h('div', { key: idx, className: 'ins-highlight' },
        h('span', { className: 'label' }, item.label),
        h('span', { className: 'value' }, item.value),
        h('span', { className: 'detail' }, item.detail),
      )
    )))
  );

  const ProtectionTips = () => {
    const tips = [
      { title: 'Verify before you trust', text: 'Call organisations using official numbers and never the details provided in a suspicious message.' },
      { title: 'Pause on urgent payment requests', text: 'Pressure to act immediately is a red flag – speak with someone you trust before transferring funds.' },
      { title: 'Secure your accounts', text: 'Enable MFA, use unique passwords, and report unusual login activity right away.' },
    ];
    return h('div', { className: 'ins-tips' }, tips.map((tip, idx) => (
      h('div', { key: idx, className: 'ins-tip' },
        h('div', { className: 'ins-tip-title' }, tip.title),
        h('div', { className: 'ins-tip-text' }, tip.text),
      )
    )));
  };

  function App() {
    const [payload, setPayload] = useState({ status: 'loading', data: null, error: null });

    useEffect(() => {
      let cancelled = false;
      loadInsights()
        .then((data) => { if (!cancelled) setPayload({ status: 'ready', data, error: null }); })
        .catch(() => { if (!cancelled) setPayload({ status: 'error', data: null, error: 'Unable to load insights data. Please try again later.' }); });
      return () => { cancelled = true; };
    }, []);

    const derived = useMemo(() => payload.status === 'ready' ? computeInsights(payload.data) : null, [payload]);

    if (payload.status === 'loading') return h('div', { className: 'ins-loading' }, 'Loading insights...');
    if (payload.status === 'error') return h('div', { className: 'ins-error-box' }, payload.error);

    return h('div', { className: 'ins-app-shell' },
      h('div', { className: 'ins-backdrop' },
        h('div', { className: 'ins-backdrop-canvas' }),
        h('div', { className: 'ins-geo-shape one' }),
        h('div', { className: 'ins-geo-shape two' }),
        h('div', { className: 'ins-geo-circle' })
      ),
      h('div', { className: 'ins-content' },
        h('div', { className: 'ins-main' },
          h(HeaderSection, { period: derived.periodLabel }),
          h(MetricGrid, { metrics: derived.metrics }),
          h('div', { className: 'ins-section-grid charts' },
            h(Card, { title: 'Scam Reports Trend', subtitle: 'Monthly reports alongside reported losses (AUD millions)' }, h(MonthlyChart, { data: derived.monthlyChart })),
            h(Card, { title: 'Most Common Scam Types', subtitle: 'Top scam categories by total reports' }, h(CategoriesChart, { data: derived.categoriesChart }))
          ),
          h('div', { className: 'ins-section-grid triple' },
            h(Card, { title: null, subtitle: null }, h(RecentAlerts, { alerts: derived.recentAlerts })),
            h(Card, { title: 'Segment Leaders', subtitle: 'Who is most impacted right now?' }, h(Highlights, { highlights: derived.highlights })),
            h(Card, { title: 'Protection Tips', subtitle: 'Share with your community' }, h(ProtectionTips, null))
          ),
          h('div', { className: 'ins-data-source' },
            'Data source: ',
            h('a', { href: 'https://www.scamwatch.gov.au/', target: '_blank', rel: 'noopener noreferrer' }, 'scamwatch.gov.au')
          )
        ),
      ),
    );
  }

  createRoot(document.getElementById('root')).render(h(App));
</script>

<!-- Keep font size controller -->
<script src="./js/config.js"></script>
<script src="./js/utils.js"></script>
<script src="./js/components/fontController.js"></script>
<script src="./js/navbar-responsive.js"></script>

</body>
</html>
